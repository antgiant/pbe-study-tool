<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PBE Study Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="vendor/compromise/compromise.js"></script>
</head>
<body>
  <div class="card">
    <h1>PBE Study Tool</h1>
    <p>A tool to help you learn PBE verses by practicing fill in the blank questions.</p>
    <div class="selectors" id="selectors-container">
      <button type="button" id="selectors-toggle" class="accordion-toggle" aria-expanded="true" aria-controls="selectors-content">Settings â–¾</button>
      <div id="selectors-content" role="region" aria-labelledby="selectors-toggle">
        <fieldset id="preset-selector">
          <legend class="fieldset-header">
            <span>Presets</span>
            <button type="button" id="preset-manage-button" class="selector-toggle"
                    aria-label="Manage presets">Manage</button>
          </legend>

          <div class="preset-controls">
            <div id="preset-options"></div>
          </div>
          <div id="preset-save-status" class="hint" style="display: none;" aria-live="polite" aria-atomic="true">
            Saved
          </div>
        </fieldset>
        <fieldset>
          <legend>Season</legend>
          <label for="year">Year</label>
          <select id="year" name="year">
          </select>
        </fieldset>
        <fieldset id="chapter-selector" style="display: none;">
          <legend class="fieldset-header">
            <span>Chapter selector</span>
            <button type="button" id="toggle-to-verse" class="selector-toggle">Verse selector</button>
          </legend>
          <div id="chapter-options"></div>
        </fieldset>
        <fieldset id="verse-selector" style="display: none;">
          <legend class="fieldset-header">
            <span>Verse selector</span>
            <button type="button" id="toggle-to-chapter" class="selector-toggle">Chapter selector</button>
          </legend>
          <div id="verse-options"></div>
        </fieldset>
        <fieldset id="blank-selector">
          <legend>Fill in the Blank</legend>
          <label for="min-blanks">Min blanks</label>
          <input type="number" id="min-blanks" name="min-blanks" min="1" value="1" step="1" inputmode="numeric" aria-describedby="min-blanks-error" />
          <div id="min-blanks-error" aria-live="polite" aria-atomic="true" class="validation-feedback"></div>
          <label for="max-blanks">Max blanks</label>
          <input type="number" id="max-blanks" name="max-blanks" min="1" value="1" step="1" inputmode="numeric" aria-describedby="max-blanks-error" />
          <div id="max-blanks-error" aria-live="polite" aria-atomic="true" class="validation-feedback"></div>
          <div id="blank-limit" class="hint">Max allowed is 1 based on selected verses.</div>
          <label for="max-blank-percentage">Max percentage blank</label>
          <input type="number" id="max-blank-percentage" name="max-blank-percentage" min="1" max="100" value="100" step="1" inputmode="numeric" />
          <label for="use-only-percentage" class="checkbox-label">
            <input type="checkbox" id="use-only-percentage" name="use-only-percentage" />
            Use only percentage
          </label>
        </fieldset>
        <fieldset id="question-type-split" style="display: none;">
          <legend>Question Type Split (must total 100%)</legend>
          <label for="fill-in-blank-percentage">Fill in the Blank Percentage</label>
          <input type="number" id="fill-in-blank-percentage" name="fill-in-blank-percentage" min="0" max="100" value="100" step="1" inputmode="numeric" aria-describedby="fill-in-blank-percentage-error" data-question-type-percentage required />
          <div id="fill-in-blank-percentage-error" aria-live="polite" aria-atomic="true" class="validation-feedback"></div>
          <div id="question-type-total" aria-live="polite" aria-atomic="true" class="hint">Total: <span id="question-type-total-value">100</span>%</div>
        </fieldset>
      </div>
    </div>
    <button type="button" id="start-button" disabled aria-label="Start quiz - disabled until verses are selected">Start</button>
    <div id="question-area" class="question-card" style="display: none;" role="region" aria-label="Question">
      <div class="question-header">
        <span id="question-title">Question 1</span>
        <button type="button" id="hint-button" class="hint-button" aria-label="Show hint for current question">Hint</button>
        <span id="question-points" class="question-points" aria-label="Points available"></span>
      </div>
      <div class="question-subline">
        <span id="question-reference" class="question-reference"></span>
      </div>
      <p id="question-text" class="question-text" role="status" aria-live="polite"></p>
      <div class="question-actions">
        <button type="button" id="prev-button" disabled aria-label="Previous question">Previous</button>
        <button type="button" id="next-button" aria-label="Show answer">Next</button>
      </div>
    </div>
    <div id="answer-area" class="question-card" style="display: none;" role="region" aria-label="Answer">
      <div class="question-header">
        <p id="answer-title">Answer</p>
        <span id="answer-points" class="question-points" aria-label="Points earned"></span>
      </div>
      <div class="question-subline">
        <span id="answer-reference" class="question-reference"></span>
      </div>
      <p id="answer-text" class="question-text" role="status" aria-live="polite"></p>
      <div class="question-actions">
        <button type="button" id="answer-prev-button" disabled aria-label="Previous answer">Previous</button>
        <button type="button" id="answer-next-button" aria-label="Next question">Next</button>
      </div>
    </div>
  </div>

  <!-- Modal for preset management -->
  <div id="preset-modal" class="modal" style="display: none;" role="dialog"
       aria-labelledby="preset-modal-title" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="preset-modal-title">Preset Manager</h2>
        <button type="button" id="preset-modal-close" class="modal-close"
                aria-label="Close preset manager">&times;</button>
      </div>
      <div class="modal-body">
        <div id="preset-list-container">
          <!-- Dynamically populated -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for save/rename -->
  <div id="preset-name-modal" class="modal" style="display: none;" role="dialog"
       aria-labelledby="preset-name-modal-title" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="preset-name-modal-title">New Preset</h2>
        <button type="button" id="preset-name-modal-close" class="modal-close"
                aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <label for="preset-name-input">Preset Name</label>
        <input type="text" id="preset-name-input" maxlength="50"
               placeholder="e.g., Job Study" aria-describedby="preset-name-error" />
        <div id="preset-name-error" class="validation-feedback"
             aria-live="polite" aria-atomic="true"></div>

        <div class="modal-actions">
          <button type="button" id="preset-name-cancel" class="btn-secondary">Cancel</button>
          <button type="button" id="preset-name-save" class="btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="script.js"></script>
</body>
</html>
